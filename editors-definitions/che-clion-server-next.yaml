#
# Copyright (c) 2024 Red Hat, Inc.
# This program and the accompanying materials are made
# available under the terms of the Eclipse Public License 2.0
# which is available at https://www.eclipse.org/legal/epl-2.0/
#
# SPDX-License-Identifier: EPL-2.0
#
# Contributors:
#   Red Hat, Inc. - initial API and implementation
#

schemaVersion: 2.3.0
metadata:
  name: che-clion-server
  displayName: JetBrains CLion 2024.2.3 (desktop)
  description: JetBrains CLion for Eclipse Che - next
  tags:
    - Tech-Preview
  attributes:
    arch:
      - x86_64
      - arm64
    publisher: che-incubator
    version: next
    provider: Provided by [Jet Brains](https://www.jetbrains.com/) under [License](https://www.jetbrains.com/legal/docs/toolbox/user/)
    title: JetBrains CLion for Eclipse Che - next
    repository: https://github.com/che-incubator/che-idea-dev-server
    firstPublicationDate: '2024-04-11'
    iconMediatype: image/svg+xml
    iconData: |
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clip-path="url(#clip0_4372_11676)">
      <path d="M64 59.9275V25.9592C64 24.3301 63.0289 22.8575 61.5319 22.2157L24.0413 6.14767C23.5345 5.93065 22.9882 5.81836 22.4367 5.81836H4.07273C1.82342 5.81836 0 7.64178 0 9.89109V27.8571C0 28.6617 0.238545 29.4483 0.685382 30.118L22.0887 62.1866C22.8439 63.3189 24.1152 63.9984 25.4761 63.9984L59.9273 64.0002C62.1766 64.0002 64 62.1768 64 59.9275Z" fill="url(#paint0_linear_4372_11676)"/>
      <path d="M58.1818 14.5193V4.07273C58.1818 1.82342 56.3584 0 54.1091 0H41.0164C40.8239 0 40.6313 0.0139636 40.4404 0.0407273L3.49673 5.3184C1.49004 5.60465 0 7.32334 0 9.34982V25.0228C0 27.2727 1.824 29.0961 4.07389 29.0956L22.6124 29.0909C23.0499 29.0909 23.4845 29.0205 23.8993 28.882L55.3972 18.3825C57.0601 17.8281 58.1818 16.2717 58.1818 14.5187V14.5193Z" fill="url(#paint1_linear_4372_11676)"/>
      <path d="M58.1812 15.9476L58.1794 4.07215C58.1794 1.82342 56.356 0 54.1067 0H42.6001C41.4114 0 40.2815 0.519564 39.5077 1.42196L6.79848 39.5834C6.16604 40.3217 5.81812 41.262 5.81812 42.2342V54.1097C5.81812 56.359 7.64153 58.1824 9.89084 58.1824H21.3992C22.5879 58.1824 23.7178 57.6628 24.4916 56.7604L57.2008 18.599C57.8338 17.8607 58.1812 16.9204 58.1812 15.9476Z" fill="#FF318C"/>
      <path d="M52 12H12V52H52V12Z" fill="black"/>
      <path d="M23.9358 32.1654C22.5066 32.1654 21.2124 31.8305 20.0529 31.1625C18.8941 30.4865 17.9838 29.5625 17.3221 28.3894C16.6609 27.2094 16.3301 25.8934 16.3301 24.4425C16.3301 22.9916 16.6609 21.6796 17.3221 20.5065C17.9832 19.3265 18.8935 18.4014 20.0529 17.7334C21.2118 17.0574 22.5061 16.7202 23.9358 16.7202C25.1444 16.7202 26.2541 16.9442 27.2638 17.3922C28.2735 17.8402 29.1124 18.4694 29.7809 19.2802C30.4564 20.0842 30.9078 21.0082 31.1358 22.0534H28.0849C27.8855 21.5134 27.5872 21.0402 27.1889 20.6345C26.7975 20.2225 26.3249 19.9054 25.7701 19.6854C25.2152 19.4654 24.6107 19.3545 23.9569 19.3545C23.0752 19.3545 22.2786 19.5745 21.5678 20.0156C20.8569 20.4568 20.2987 21.0648 19.8929 21.8396C19.4946 22.6076 19.2958 23.4756 19.2958 24.4425C19.2958 25.4094 19.4946 26.2814 19.8929 27.0556C20.2981 27.8236 20.8564 28.4276 21.5678 28.8688C22.2786 29.3099 23.0752 29.5299 23.9569 29.5299C24.6112 29.5299 25.2158 29.4191 25.7701 29.1991C26.3249 28.9791 26.7975 28.6659 27.1889 28.2602C27.5872 27.8482 27.8855 27.3711 28.0849 26.8311H31.1358C30.9084 27.8762 30.4564 28.8042 29.7809 29.6151C29.1124 30.4191 28.2735 31.0442 27.2638 31.4922C26.2541 31.9402 25.1444 32.1642 23.9358 32.1642V32.1654ZM36.1306 16.9756V29.2848H43.2135V31.9088H33.2295V16.9756H36.1306Z" fill="white"/>
      <path d="M33 44H17V47H33V44Z" fill="white"/>
      </g>
      <defs>
      <linearGradient id="paint0_linear_4372_11676" x1="3.98138" y1="4.22243" x2="62.6868" y2="62.9273" gradientUnits="userSpaceOnUse">
      <stop offset="0.29" stop-color="#009AE5"/>
      <stop offset="0.7" stop-color="#00D980"/>
      </linearGradient>
      <linearGradient id="paint1_linear_4372_11676" x1="56.3788" y1="-0.71738" x2="2.75258" y2="24.1455" gradientUnits="userSpaceOnUse">
      <stop offset="0.3" stop-color="#FF318C"/>
      <stop offset="0.54" stop-color="#009AE5"/>
      </linearGradient>
      <clipPath id="clip0_4372_11676">
      <rect width="64" height="64" fill="white"/>
      </clipPath>
      </defs>
      </svg>
commands:
  - id: inject-editor
    apply:
      component: editor-injector
  - id: start-ide-server
    exec:
      component: editor-runtime
      commandLine: nohup /idea-server/entrypoint-volume.sh > /idea-server/std.out
        2>&1 &
events:
  preStart:
    - inject-editor
  postStart:
    - start-ide-server
components:
  - name: idea-server
    volume: {}
  - name: editor-injector
    container:
      image: quay.io/che-incubator/che-idea-dev-server:next
      command: ['/entrypoint-init-container.sh', 'clion']
      volumeMounts:
        - name: idea-server
          path: /idea-server
      memoryLimit: 256Mi
      memoryRequest: 32Mi
      cpuLimit: 500m
      cpuRequest: 30m
  - name: editor-runtime
    container:
      image: quay.io/devfile/universal-developer-image:latest
      memoryLimit: 6144Mi
      memoryRequest: 2048Mi
      cpuLimit: 2000m
      cpuRequest: 1500m
      volumeMounts:
        - name: idea-server
          path: /idea-server
      endpoints:
        - name: idea-server
          attributes:
            type: main
            cookiesAuthEnabled: true
            discoverable: false
            urlRewriteSupported: true
          targetPort: 3400
          exposure: public
          secure: true
          protocol: https
    attributes:
      app.kubernetes.io/component: editor-runtime
      app.kubernetes.io/part-of: ide-server.eclipse.org
      controller.devfile.io/container-contribution: true